{% extends "base.html" %}
{% load static %}
{% block content %}
    <div class="module-header">
        <h2>إدارة الموظفين</h2>
        <a href="{% url 'employ:employee_register' %}" class="btn btn-primary">
            <i class="fas fa-user-plus"></i> تسجيل موظف جديد
        </a>
    </div>
        {% include "partials/_alerts.html" %}

    <div class="tabs">
        <div class="tab active" data-tab="employees">الموظفون النشطون</div>
    </div>

    <div class="filters">
        <div class="form-row">
            <div class="form-col">
                <select id="positionFilter" class="form-control">
                    <option value="">جميع الوظائف</option>
                    <option value="teacher">مدرس</option>
                    <option value="admin">إداري</option>
                    <option value="accountant">محاسب</option>
                    <option value="manager">مدير</option>
                    <option value="other">أخرى</option>
                </select>
            </div>
            <div class="form-col">
                <input type="text" id="searchInput" class="form-control" placeholder="بحث بالاسم...">
            </div>
        </div>
    </div>

    <div class="tab-content active" id="employees-tab">
        <div class="table-container">
            <table id="employeesTable" class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>الاسم الكامل</th>
                        <th>الوظيفة</th>
                        <th>تاريخ التعيين</th>
                        <th>الراتب</th>
                        {% comment %} <th>الإجراءات</th> {% endcomment %}
                    </tr>
                </thead>
                <tbody>
                    {% for employee in employees %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ employee.user.get_full_name }}</td>
                        <td>{{ employee.get_position_display }}</td>
                        <td>{{ employee.hire_date|date:"Y-m-d" }}</td>
                        <td>{{ employee.salary }}</td>
                        {% comment %} <td>
                            <button class="btn btn-sm btn-info edit-btn" data-id="{{ employee.id }}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger terminate-btn" data-id="{{ employee.id }}">
                                <i class="fas fa-user-times"></i>
                            </button>
                            <button class="btn btn-sm btn-success checkin-btn" data-id="{{ employee.id }}">
                                <i class="fas fa-calendar-check"></i>
                            </button>
                        </td> {% endcomment %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">لا يوجد موظفين مسجلين</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <!-- نموذج إضافة/تعديل موظف -->
    <!-- نموذج إنهاء خدمة موظف -->
    <div id="terminateModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>إنهاء خدمة موظف</h3>
            <form id="terminateForm">
                <div class="form-row">
                    <div class="form-col">
                        <label for="terminationDate">تاريخ إنهاء الخدمة</label>
                        <input type="date" id="terminationDate" required>
                    </div>
                    <div class="form-col">
                        <label for="terminationReason">سبب إنهاء الخدمة</label>
                        <select id="terminationReason" required>
                            <option value="">اختر السبب</option>
                            <option value="resignation">استقالة</option>
                            <option value="termination">إنهاء خدمة</option>
                            <option value="retirement">تقاعد</option>
                            <option value="other">أخرى</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="terminationNotes">ملاحظات</label>
                        <textarea id="terminationNotes" rows="3"></textarea>
                    </div>
                </div>

                <button type="submit" class="btn btn-danger">تأكيد إنهاء الخدمة</button>
            </form>
        </div>
    </div>

    <!-- نموذج تسجيل الحضور -->
    <div id="checkinModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>تسجيل حضور الموظف</h3>
            <form id="checkinForm">
                <div class="form-row">
                    <div class="form-col">
                        <label for="checkinEmployee">الموظف</label>
                        <select id="checkinEmployee" required>
                            <option value="">اختر الموظف</option>
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="checkinDate">التاريخ</label>
                        <input type="date" id="checkinDate" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="checkinTime">وقت الدخول</label>
                        <input type="time" id="checkinTime" required>
                    </div>
                    <div class="form-col">
                        <label for="checkoutTime">وقت الخروج</label>
                        <input type="time" id="checkoutTime">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="checkinStatus">حالة الحضور</label>
                        <select id="checkinStatus" required>
                            <option value="present">حاضر</option>
                            <option value="absent">غائب</option>
                            <option value="late">متأخر</option>
                            <option value="vacation">إجازة</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="checkinNotes">ملاحظات</label>
                        <input type="text" id="checkinNotes">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">حفظ</button>
            </form>
        </div>
    </div>
    <script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // البحث والتصفية
    const positionFilter = document.getElementById('positionFilter');
    const searchInput = document.getElementById('searchInput');
    
    function applyFilters() {
        const position = positionFilter.value;
        const search = searchInput.value.trim();
        
        let url = window.location.pathname;
        let params = new URLSearchParams();
        
        if (position) params.append('position', position);
        if (search) params.append('search', search);
        
        window.location.href = url + '?' + params.toString();
    }
    
    positionFilter.addEventListener('change', applyFilters);
    searchInput.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') applyFilters();
    });

    // باقي الكود الخاص بالنوافذ المنبثقة...
    const terminateModal = document.getElementById('terminateModal');
    const checkinModal = document.getElementById('checkinModal');
    const closeButtons = document.querySelectorAll('.close');

    // فتح نافذة إنهاء خدمة موظف
    function openTerminateModal(employeeId) {
        terminateModal.style.display = 'block';
        // يمكنك هنا جلب بيانات الموظف عبر AJAX إذا لزم الأمر
    }

    // فتح نافذة تسجيل الحضور
    function openCheckinModal(employeeId) {
        checkinModal.style.display = 'block';
        // يمكنك هنا جلب بيانات الموظف عبر AJAX إذا لزم الأمر
    }

    // إغلاق النوافذ المنبثقة
    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            terminateModal.style.display = 'none';
            checkinModal.style.display = 'none';
        });
    });

    // إغلاق النوافذ عند النقر خارجها
    window.addEventListener('click', function(event) {
        if (event.target === terminateModal) {
            terminateModal.style.display = 'none';
        }
        if (event.target === checkinModal) {
            checkinModal.style.display = 'none';
        }
    });

    // ربط أحداث الأزرار في الجدول
    document.addEventListener('click', function(e) {
        if (e.target.closest('.terminate-btn')) {
            const employeeId = e.target.closest('.terminate-btn').dataset.id;
            openTerminateModal(employeeId);
        }
        else if (e.target.closest('.checkin-btn')) {
            const employeeId = e.target.closest('.checkin-btn').dataset.id;
            openCheckinModal(employeeId);
        }
    });
});
</script>
    </script>
{% endblock %}