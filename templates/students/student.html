{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="module-header">
    <h2>إدارة الطلاب</h2>
    <button class="btn btn-primary" id="addStudentBtn">
    <a href="{% url "students:create_student" %}" style="color:white;"><i class="fas fa-plus"></i> إضافة طالب جديد</a>
    </button>
</div>
{% include "partials/_alerts.html" %}


<!-- نموذج إضافة طالب جديد (محدث) -->
{% comment %} <div id="studentModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3 id="studentModalTitle">إضافة طالب جديد</h3>
        <form method="POST" id="studentForm">
            {% csrf_token %}        
            <!-- المعلومات الأساسية -->
            <h4 class="section-title">المعلومات الأساسية</h4>
            <div class="form-row">
                <div class="form-col">

                    <label for="fullName" class="required-field">الاسم الكامل للطالب</label>
                    <input type="text" id="fullName" name="full_name" required>
                </div>
                <div class="form-col">
                    <label for="gender" class="required-field">الجنس</label>
                    <select id="gender" name="gender" required>
                        <option value="male">ذكر</option>
                        <option value="female">أنثى</option>
                    </select>
                </div>
            </div>
            <div class="form-col">
                        <label for="branch" class="required-field">الفرع</label>
                        <select id="branch" name="branch" required>
                            <option value="art">أدبي</option>
                            <option value="sinc">علمي</option>
                            <option value="asas">تاسع</option>
                        </select>
                    </div>
            <div class="form-row">
                <div class="form-col">
                    <label for="birthDate" class="required-field">تاريخ الميلاد</label>
                    <input type="date" id="birthDate" name="birth" required>
                </div>
                <div class="form-col">
                    <label for="studentId" class="required-field">رقم الطالب</label>
                    <input type="text" id="studentId" name="stu_phone" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label for="nationality" class="required-field">الجنسية</label>
                    <input type="text" id="nationality" name="nationality" required>
                </div>
                <div class="form-col">
                    <label for="registrationDate" class="required-field">تاريخ التسجيل</label>
                    <input type="date" id="registrationDate" name="date" required>
                </div>
            </div>

            <!-- معلومات الأب -->
            <h4 class="section-title">معلومات ولي الأمر (الأب)</h4>
            <div class="form-row">
                <div class="form-col">
                    <label for="fatherName" class="required-field">اسم الأب</label>
                    <input type="text" id="fatherName" name="fatherName" required>
                </div>
                <div class="form-col">
                    <label for="fatherJob">عمل الأب</label>
                    <input type="text" id="fatherJob" name="fatherJob">
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label for="fatherPhone" class="required-field">رقم هاتف الأب</label>
                    <input type="tel" id="fatherPhone" name="fatherPhone" required>
                </div>
            </div>

            <!-- معلومات الأم -->
            <h4 class="section-title">معلومات ولي الأمر (الأم)</h4>
            <div class="form-row">
                <div class="form-col">
                    <label for="motherName">اسم الأم</label>
                    <input type="text" id="motherName" name="motherName">
                </div>
                <div class="form-col">
                    <label for="motherJob">عمل الأم</label>
                    <input type="text" id="motherJob" name="motherJob">
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label for="motherPhone">رقم هاتف الأم</label>
                    <input type="tel" id="motherPhone" name="motherPhone">
                </div>
            </div>

            <!-- معلومات السكن -->
            <h4 class="section-title">معلومات السكن</h4>
            <div class="form-row">
                <div class="form-col">
                    <label for="address" class="required-field">العنوان السكني</label>
                    <textarea id="address" name="address" required></textarea>
                </div>
                <div class="form-col">
                    <label for="landlinePhone">رقم الهاتف الأرضي</label>
                    <input type="tel" id="landlinePhone" name="home_phone">
                </div>
            </div>

            <!-- معلومات الدراسة -->
            <h4 class="section-title">معلومات الدراسة السابقة</h4>
            <div class="form-row">
                <div class="form-col">
                    <label for="previousSchool">المدرسة السابقة</label>
                    <input type="text" id="previousSchool" name="last_school">
                </div>
                <div class="form-col">
                    <label for="elementarySchool">مدرسة الابتدائية</label>
                    <input type="text" id="elementarySchool" name="ele_school">
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label for="howKnewUs">كيف عرفت المعهد؟</label>
                    <select id="howKnewUs" name="how_knew_us">
                        <option value="">اختر طريقة التعرف</option>
                        <option value="friend">صديق</option>
                        <option value="social">مواقع التواصل</option>
                        <option value="ad">إعلان</option>
                        <option value="other">أخرى</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label for="notes">ملاحظات</label>
                    <textarea id="notes" name="notes"></textarea>
                </div>
            </div>

            <button type="submit" name="btn_save" class="btn btn-primary"> 
                    <span> حفظ</span>
            </button>
            
        </form>
    </div>
</div> {% endcomment %}

    <div class="tabs">
        <div class="tab active" data-tab="students">الطلاب المسجلين</div>
        <div class="tab" data-tab="withdrawn">الطلاب المسحوبين</div>
        <div class="tab" data-tab="transferred">الطلاب المنقولين</div>
    </div>
    <div class="tab-content active" id="teachers-tab">
        <div class="table-container">
            <table id="teachersTable">
                
                <thead>
                    <tr>
                        <th>#</th>
                        <th>id</th>
                        <th>الاسم </th>
                        <th>رقم الهاتف</th>
                        <th>الصف</th>
                    </tr>
                    {% for student in student %}
                    <tr>
                        <th>#</th>
                        <th>{{student.id}}</th>
                        <td><a href="{% url 'students:student_profile' student.id %}">{{student.full_name}}</a> </td>
                        <td> {{student.student_number}}</td>
                        <td>{{student.branch}}</td>
                    </tr>
                    {% endfor %}
                </thead>
                <tbody>
                    <!-- سيتم ملؤها بواسطة JavaScript -->
                </tbody>
            </table>
        </div>
</div>
    <!-- نموذج نقل طالب -->
    <div id="transferModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>نقل طالب إلى صف آخر</h3>
            <form id="transferForm">
                <div class="form-row">
                    <div class="form-col">
                        <label for="currentClass">الصف الحالي</label>
                        <input type="text" id="currentClass" readonly>
                    </div>
                    <div class="form-col">
                        <label for="newClass">الصف الجديد</label>
                        <select id="newClass" required>
                            <option value="">اختر الصف الجديد</option>
                            <option value="1">الصف الأول</option>
                            <option value="2">الصف الثاني</option>
                            <!-- باقي الصفوف -->
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="transferDate">تاريخ النقل</label>
                        <input type="date" id="transferDate" required>
                    </div>
                    <div class="form-col">
                        <label for="transferReason">سبب النقل</label>
                        <select id="transferReason">
                            <option value="">اختر السبب</option>
                            <option value="level">تقدم في المستوى</option>
                            <option value="request">طلب ولي الأمر</option>
                            <option value="other">أخرى</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="transferNotes">ملاحظات</label>
                        <textarea id="transferNotes" rows="2"></textarea>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">تأكيد النقل</button>
            </form>
        </div>
</div>

    <script>
        
        document.getElementById('addStudentBtn').addEventListener('click', function() {
        document.getElementById('studentModal').style.display = 'block';
        document.getElementById('studentModalTitle').textContent = 'إضافة طالب جديد';
        document.getElementById('studentForm').reset();
    });

    // إغلاق النافذة المنبثقة
    document.querySelector('.close').addEventListener('click', function() {
        document.getElementById('studentModal').style.display = 'none';
    });

    document.getElementById('cancelBtn').addEventListener('click', function() {
        document.getElementById('studentModal').style.display = 'none';
    });

    // إغلاق النافذة عند النقر خارجها
    window.addEventListener('click', function(event) {
        if (event.target === document.getElementById('studentModal')) {
            document.getElementById('studentModal').style.display = 'none';
        }
    });

        // معالجة إرسال النموذج
    </script>
{% endblock %}

