{% extends "base.html" %}
{% load static %}
{% block content %}
    <div class="module-header">
        <h2>الملف الشخصي للطالب</h2>
    </div>
    <div class="header-actions">
        <div class="student-info">
            <h3 id="studentName">{{ student.full_name }}</h3>
            <p class="student-id">رقم الطالب: <span id="studentId">{{ student.student_number }}</span></p>
            <p class="student-class">الصف الحالي: <span id="currentClass">{{ student.get_branch_display }}</span></p>
            <p class="join-date">تاريخ التسجيل: <span id="joinDate">{{ student.registration_date|date:"Y-m-d" }}</span></p>
        </div>
    </div>

    <div class="profile-content">
        <div class="tabs">
            <div class="tab active" data-tab="info">المعلومات الأساسية</div>
            <div class="tab" data-tab="academic">العلامات والحضور</div>
        </div>

        <div class="tab-content active" id="info-tab">
            <!-- محتوى المعلومات الأساسية -->
            <div class="info-section">
                <h4 class="section-title"><i class="fas fa-user"></i> المعلومات الشخصية</h4>
                <div class="form-row">
                    <div class="form-col">
                        <label><i class="fas fa-signature"></i> الاسم الكامل</label>
                        <p class="info-value">{{ student.full_name }}</p>
                    </div>
                    <div class="form-col">
                        <label><i class="fas fa-venus-mars"></i> الجنس</label>
                        <p class="info-value">
                            {% if student.gender == 'male' %}ذكر{% else %}أنثى{% endif %}
                        </p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><i class="fas fa-birthday-cake"></i> تاريخ الميلاد</label>
                        <p class="info-value">{{ student.birth_date|date:"Y-m-d" }}</p>
                    </div>
                    <div class="form-col">
                        <label><i class="fas fa-flag"></i> الجنسية</label>
                        <p class="info-value">{{ student.nationality }}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><i class="fas fa-graduation-cap"></i> الصف الدراسي</label>
                        <p class="info-value">{{ student.get_branch_display }}</p>
                    </div>
                    <div class="form-col">
                        <label><i class="fas fa-graduation-cap"></i>  علامة التاسع</label>
                        <p class="info-value">{{ student.tase3 }}</p>
                    </div>
                    <div class="form-col">
                        <label><i class="fas fa-hashtag"></i> رقم الطالب</label>
                        <p class="info-value">{{ student.student_number }}</p>
                    </div>
                    <div class="form-col">
                        <label><i class="fas fa-hashtag"></i> الامراض</label>
                        <p class="info-value">{{ student.disease }}</p>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h4 class="section-title"><i class="fas fa-users"></i> معلومات العائلة</h4>
                <div class="form-row">
                    <div class="form-col">
                        <label><i class="fas fa-user"></i> اسم الأب</label>
                        <p class="info-value">{{ student.father_name }}</p>
                    </div>
                    <div class="form-col">
                        <label><i class="fas fa-briefcase"></i> عمل الأب</label>
                        <p class="info-value">{{ student.father_job|default:"غير محدد" }}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><i class="fas fa-phone"></i> هاتف الأب</label>
                        <p class="info-value">{{ student.father_phone }}</p>
                    </div>
                    <div class="form-col">
                        <label><i class="fas fa-user"></i> اسم الأم</label>
                        <p class="info-value">{{ student.mother_name|default:"غير محدد" }}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><i class="fas fa-briefcase"></i> عمل الأم</label>
                        <p class="info-value">{{ student.mother_job|default:"غير محدد" }}</p>
                    </div>
                    <div class="form-col">
                        <label><i class="fas fa-phone"></i> هاتف الأم</label>
                        <p class="info-value">{{ student.mother_phone|default:"غير محدد" }}</p>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h4 class="section-title"><i class="fas fa-map-marker-alt"></i> معلومات التواصل</h4>
                <div class="form-row">
                    <div class="form-col full-width">
                        <label><i class="fas fa-home"></i> العنوان</label>
                        <p class="info-value">{{ student.address }}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><i class="fas fa-phone"></i> هاتف المنزل</label>
                        <p class="info-value">{{ student.home_phone|default:"غير محدد" }}</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="academic-tab">
            <!-- قسم العلامات والحضور الجديد -->
            <div class="info-section">
                <h4 class="section-title"><i class="fas fa-chart-line"></i> العلامات والشعب</h4>
                
                {% for enrollment in enrollments %}
                <div class="classroom-card">
                    <h5>{{ enrollment.classroom.name }}</h5>
                    <p class="class-type">{{ enrollment.classroom.get_class_type_display }}</p>
                    
                    <div class="grades-attendance">
                        <!-- العلامات -->
                        <div class="grades-section">
                            <h6>العلامات:</h6>
                            {% for grade in enrollment.classroom.grade_set.all %}
                                {% if grade.student.id == student.id %}
                                <div class="grade-item">
                                    <span class="subject">{{ grade.subject.name }}:</span>
                                    <span class="score">{{ grade.grade }}</span>
                                    <span class="exam-type">({{ grade.get_exam_type_display }})</span>
                                </div>
                                {% endif %}
                            {% empty %}
                                <p class="no-data">لا توجد علامات مسجلة</p>
                            {% endfor %}
                        </div>
                        
                        <!-- نسبة الحضور -->
                        <div class="attendance-section">
                            <h6>نسبة الحضور:</h6>
                            {% if enrollment.total_attendance > 0 %}
                                <div class="attendance-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: {{ enrollment.attendance_percentage }}%"></div>
                                    </div>
                                    <span class="attendance-percentage">{{ enrollment.attendance_percentage|floatformat:0 }}%</span>
                                </div>
                                <p class="attendance-details">({{ enrollment.present_attendance }} حاضر من {{ enrollment.total_attendance }} حصة)</p>
                            {% else %}
                                <p class="no-data">لا توجد بيانات حضور</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <p class="no-data">الطالب غير مسجل في أي شعبة حالياً</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <style>
        /* أنماط CSS تبقى كما هي */
        .student-profile-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .profile-sidebar {
            width: 300px;
            flex-shrink: 0;
        }

        .profile-content {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .student-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .student-avatar {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
        }

        .student-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .edit-avatar {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }

        .student-info h3 {
            margin: 0 0 10px;
            color: #333;
        }

        .student-info p {
            margin: 5px 0;
            color: #666;
        }

        .student-stats {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .stat-item i {
            font-size: 24px;
            margin-right: 15px;
            color: #007bff;
        }

        .stat-item h4 {
            margin: 0;
            font-size: 12px;
            color: #666;
        }

        .stat-item p {
            margin: 0;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            border-bottom-color: #007bff;
            color: #007bff;
            font-weight: bold;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .info-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .section-title {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #007bff;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-col {
            flex: 1;
        }

        .form-col.full-width {
            flex: 2;
        }

        .info-value {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            min-height: 20px;
            margin: 5px 0 0;
        }

        label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge.completed {
            background: #28a745;
            color: white;
        }

        .badge.active {
            background: #17a2b8;
            color: white;
        }

        .badge.present {
            background: #28a745;
            color: white;
        }

        .badge.absent {
            background: #dc3545;
            color: white;
        }

        .badge.paid {
            background: #28a745;
            color: white;
        }

        .badge.pending {
            background: #ffc107;
            color: #212529;
        }
         /* تنسيقات قسم العلامات والحضور */
        .classroom-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .classroom-card h5 {
            margin: 0 0 5px;
            color: #2c3e50;
        }
        
        .class-type {
            color: #7f8c8d;
            margin: 0 0 15px;
            font-size: 14px;
        }
        
        .grades-attendance {
            display: flex;
            gap: 20px;
        }
        
        .grades-section, .attendance-section {
            flex: 1;
        }
        
        .grades-section h6, .attendance-section h6 {
            margin: 0 0 10px;
            color: #34495e;
        }
        
        .grade-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .subject {
            font-weight: bold;
        }
        
        .score {
            color: #27ae60;
            font-weight: bold;
        }
        
        .exam-type {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .attendance-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            flex: 1;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #3498db;
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        .attendance-percentage {
            font-weight: bold;
            color: #2c3e50;
            min-width: 40px;
        }
        
        .attendance-details {
            margin: 0;
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .no-data {
            color: #95a5a6;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .grades-attendance {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // تعريف المتغيرات للعناصر الرئيسية
            const addCourseModal = document.getElementById('addCourseModal');
            const transferModal = document.getElementById('transferModal');
            const receiptModal = document.getElementById('receiptModal');

            // زر إضافة دورة جديدة
            const addCourseBtn = document.getElementById('addCourseBtn');
            if (addCourseBtn) {
                addCourseBtn.addEventListener('click', function () {
                    addCourseModal.style.display = 'block';
                });
            }

            // زر نقل الطالب
            const transferStudentBtn = document.getElementById('transferStudentBtn');
            if (transferStudentBtn) {
                transferStudentBtn.addEventListener('click', function () {
                    transferModal.style.display = 'block';
                });
            }

            // زر طباعة الإيصال
            const printReceiptBtn = document.getElementById('printReceiptBtn');
            if (printReceiptBtn) {
                printReceiptBtn.addEventListener('click', function () {
                    receiptModal.style.display = 'block';
                });
            }

            // إغلاق النوافذ المنبثقة عند النقر على الزر ×
            const closeButtons = document.querySelectorAll('.close');
            closeButtons.forEach(function (button) {
                button.addEventListener('click', function () {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                });
            });

            // إغلاق النوافذ المنبثقة عند النقر خارجها
            window.addEventListener('click', function (event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });

            // تبديل تبويبات المحتوى
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(function (tab) {
                tab.addEventListener('click', function () {
                    // إزالة التنشيط من جميع التبويبات
                    tabs.forEach(function (t) {
                        t.classList.remove('active');
                    });

                    // إضافة التنشيط للتبويب المحدد
                    this.classList.add('active');

                    // إخفاء جميع محتويات التبويبات
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(function (content) {
                        content.classList.remove('active');
                    });

                    // إظهار محتوى التبويب المحدد
                    const tabId = this.getAttribute('data-tab');
                    const contentElement = document.getElementById(tabId + '-tab');
                    if (contentElement) {
                        contentElement.classList.add('active');
                    }
                });
            });

            // معالجة إرسال نموذج إضافة دورة
            const addCourseForm = document.getElementById('addCourseForm');
            if (addCourseForm) {
                addCourseForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    // هنا سيتم إرسال البيانات إلى الخادم
                    addCourseModal.style.display = 'none';
                });
            }

            // معالجة إرسال نموذج نقل الطالب
            const transferForm = document.getElementById('transferForm');
            if (transferForm) {
                transferForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    // هنا سيتم إرسال البيانات إلى الخادم
                    transferModal.style.display = 'none';
                });
            }
        });
    </script>
{% endblock %}